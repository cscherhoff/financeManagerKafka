pipeline {
    agent any
    stages {
        stage("Stop running microservices container") {
            steps {
                catchError(buildResult: 'SUCCESS', stageResult: 'FAILURE') {
                  bat """docker-compose -p finance_test down --remove-orphans"""
                }
            }
        }
        stage("Delete old docker images") {
            steps {
                catchError(buildResult: 'SUCCESS', stageResult: 'FAILURE') {
                  bat "docker rmi -f finance_test_web-application"
                }
            }
        }
        stage("Package") {
            steps {
                bat """cd allocator-service-ms/allocator-service
                mvn clean install"""
				bat """cd allocator-service-ms
                mvn clean package"""
            }
        }
        stage("Docker webApplication") {
            steps {
                bat "docker-compose -p finance_kafka_test -f docker-compose.yml up -d"
            }
        }
    }
}
